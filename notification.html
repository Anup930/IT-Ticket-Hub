<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifications - IT Ticket Hub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background-color: #f1f5f9; font-family: 'Segoe UI', sans-serif; }
    .notif-card { 
      border-left: 5px solid #ccc; 
      transition: transform 0.2s; 
      cursor: pointer;
    }
    .notif-card:hover { transform: translateX(5px); }
    
    /* Notification Types */
    .type-new { border-color: #3b82f6; background: #eff6ff; } /* Blue */
    .type-feedback { border-color: #f59e0b; background: #fffbeb; } /* Yellow */
    .type-reply { border-color: #10b981; background: #ecfdf5; } /* Green */
    
    .icon-box { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
  </style>
</head>
<body>

<div class="container py-5" style="max-width: 600px;">
  
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-dark"><i class="fas fa-bell text-warning me-2"></i>Notifications</h3>
    <button class="btn btn-outline-secondary btn-sm" onclick="goBack()">
      <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
    </button>
  </div>

  <div id="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 text-muted">Checking for updates...</p>
  </div>

  <div id="notifList" class="d-none"></div>

  <div id="emptyState" class="text-center d-none py-5">
    <img src="https://cdn-icons-png.flaticon.com/512/4076/4076478.png" width="100" class="mb-3 opacity-50">
    <h5 class="text-muted">All caught up!</h5>
    <p class="small text-secondary">No new actions required.</p>
  </div>

</div>

<script>
  // *** PASTE YOUR API URL HERE ***
  const API_URL = "https://script.google.com/macros/s/AKfycbxnr626khgFH_xJgcGnw8NgIyPRhBJeaqBIRmxTj2FRqd8swt5hbSeanh70EaD7icRp/exec";

  const userId = sessionStorage.getItem('userId');
  const role = sessionStorage.getItem('role');

  if(!userId) window.location.href = 'index.html';

  window.onload = function() {
    fetchNotifications();
  };

  function goBack() {
    if(role === 'Admin') window.location.href = 'admin.html';
    else window.location.href = 'user.html';
  }

  function fetchNotifications() {
    fetch(`${API_URL}?action=getNotifications&userId=${userId}&role=${role}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById('loading').classList.add('d-none');
        const list = document.getElementById('notifList');
        const empty = document.getElementById('emptyState');
        
        list.innerHTML = '';

        if (!data || data.length === 0) {
          empty.classList.remove('d-none');
        } else {
          list.classList.remove('d-none');
          data.forEach(n => {
            // Determine Icon and Color
            let icon = 'fa-info-circle'; 
            let bgClass = 'bg-secondary';
            let textClass = 'text-secondary';
            
            if(n.type === 'new') { icon = 'fa-plus'; bgClass = 'bg-primary'; textClass = 'text-primary'; }
            else if(n.type === 'feedback') { icon = 'fa-star'; bgClass = 'bg-warning'; textClass = 'text-warning'; }
            else if(n.type === 'reply') { icon = 'fa-comment-dots'; bgClass = 'bg-success'; textClass = 'text-success'; }

            list.innerHTML += `
              <div class="card notif-card type-${n.type} mb-3 shadow-sm" onclick="window.location.href='${n.link}'">
                <div class="card-body d-flex align-items-center">
                  <div class="icon-box ${bgClass} bg-opacity-10 me-3">
                    <i class="fas ${icon} ${textClass}"></i>
                  </div>
                  <div>
                    <h6 class="fw-bold mb-1">${n.title}</h6>
                    <p class="mb-0 small text-secondary">${n.msg}</p>
                  </div>
                  <div class="ms-auto">
                    <i class="fas fa-chevron-right text-muted small"></i>
                  </div>
                </div>
              </div>
            `;
          });
        }
      })
      .catch(err => {
        console.error(err);
        document.getElementById('loading').innerHTML = '<p class="text-danger">Failed to load notifications.</p>';
      });
  }
</script>

</body>
</html>
